# Définition des variables
$OUComputers = "OU=Ordinateurs,DC=ecosolarsolution,DC=local"
$OUUsers = "OU=Utilisateurs,DC=ecosolarsolution,DC=local"  # Modifier si nécessaire

# Associer chaque PC à un utilisateur
For ($i=1; $i -le 60; $i++) {
    $ComputerName = "ECL_" + ($i.ToString("000"))  # Génère ECL_001 à ECL_060
    $UserName = "User" + ($i.ToString("000"))      # Génère User001 à User060

    # Vérifier si l'utilisateur existe
    $User = Get-ADUser -Filter {SamAccountName -eq $UserName}
    # Vérifier si l'ordinateur existe
    $Computer = Get-ADComputer -Filter {Name -eq $ComputerName}

    if ($User -and $Computer) {
        # Correction : ajout correct de l'attribut ms-Mcs-PrimaryComputer
        Set-ADUser -Identity $User.SamAccountName -Add @{ms-Mcs-PrimaryComputer=$Computer.DistinguishedName}
        
        Write-Host "L'utilisateur $UserName est maintenant associé à l'ordinateur $ComputerName."
    } else {
        Write-Host "⚠️ Problème : $UserName ou $ComputerName n'existe pas."
    }
}
