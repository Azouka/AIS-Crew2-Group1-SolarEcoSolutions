
$domain = "DC=ecosolarsolution,DC=local"

$OUs = @(
    "Direction",
    "Informatique",
    "Atelier",
    "Logistique/approvisionnement",
    "Production",
    "R&D/qualité",
    "Service commercial",
    "Expédition",
    "Dpt Administratif & Financier"
)

foreach ($OU in $OUs) {
    $ouPath = "OU=$OU,$domain"
    if (-not (Get-ADOrganizationalUnit -Filter "DistinguishedName -eq '$ouPath'" -ErrorAction SilentlyContinue)) {
        New-ADOrganizationalUnit -Name $OU -Path $domain -ProtectedFromAccidentalDeletion $true
        Write-Output "OU '$OU' créée avec succès."
    } else {
        Write-Output "OU '$OU' existe déjà."
    }
}



# Définir le domaine racine
$domain = "DC=ecosolarsolution,DC=local"

# Liste des utilisateurs avec leurs informations
$users = @(
    @{GivenName="Wally"; Surname="Adam"; Title=""; OU="Direction"},
    @{GivenName="Herminia"; Surname="Oliva"; Title="Assistante DG"; OU="Direction"},
    @{GivenName="Elijah"; Surname="Blakley"; Title="Informaticien"; OU="Informatique"},
    @{GivenName="Nguyet"; Surname="Catlett"; Title="Stagiaire alternance"; OU="Informatique"},
    @{GivenName="Phyllis"; Surname="Biondo"; Title="Directeur production - DG Adjoint"; OU="Production"},
    @{GivenName="Davie"; Surname="Ivan"; Title="Responsable atelier"; OU="Atelier"},
    @{GivenName="Hyatt"; Surname="Marcy"; Title="Technicienne maintenance 1"; OU="Atelier"}
)

# Mot de passe par défaut pour les utilisateurs
$password = ConvertTo-SecureString "P@ssw0rd123" -AsPlainText -Force

# Création des utilisateurs
foreach ($user in $users) {
    $samAccountName = ($user.GivenName.Substring(0,1) + $user.Surname).ToLower()
    $userPath = "OU=$($user.OU),$domain"
    
    if (-not (Get-ADUser -Filter "SamAccountName -eq '$samAccountName'" -ErrorAction SilentlyContinue)) {
        New-ADUser -GivenName $user.GivenName -Surname $user.Surname -Name "$($user.GivenName) $($user.Surname)" `
        -SamAccountName $samAccountName -UserPrincipalName "$samAccountName@ecosolarsolution.local" `
        -Path $userPath -Title $user.Title -AccountPassword $password -Enabled $true `
        -ChangePasswordAtLogon $true
        Write-Output "Utilisateur '$($user.GivenName) $($user.Surname)' ajouté dans l'OU '$($user.OU)'."
    } else {
        Write-Output "Utilisateur '$($user.GivenName) $($user.Surname)' existe déjà."
    }
}

