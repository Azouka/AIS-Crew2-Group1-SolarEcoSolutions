# Définition des variables
$OUName = "Ordinateurs"
$OUPath = "OU=$OUName,DC=ecosolarsolution,DC=local"

# Vérifier et créer l'OU si elle n'existe pas
if (-not (Get-ADOrganizationalUnit -Filter {Name -eq $OUName})) {
    New-ADOrganizationalUnit -Name $OUName -Path "DC=ecosolarsolution,DC=local" -ProtectedFromAccidentalDeletion $false
    Start-Sleep -Seconds 2
    Write-Host "OU $OUName créée avec succès."
} else {
    Write-Host "OU $OUName existe déjà."
}

# Étape 1 : Supprimer les ordinateurs mal placés
For ($i=1; $i -le 60; $i++) {
    $ComputerName = "ECL_" + ($i.ToString("000"))
    $Computer = Get-ADComputer -Filter {Name -eq $ComputerName}
    
    if ($Computer) {
        Remove-ADComputer -Identity $Computer -Confirm:$false
        Write-Host "Ordinateur $ComputerName supprimé."
    }
}

# Étape 2 : Recréer les ordinateurs dans l'OU correcte
For ($i=1; $i -le 60; $i++) {
    $ComputerName = "ECL_" + ($i.ToString("000"))
    
    if (-not (Get-ADComputer -Filter {Name -eq $ComputerName})) {
        New-ADComputer -Name $ComputerName -Path $OUPath -Enabled $true
        Write-Host "Ordinateur $ComputerName créé dans l'OU $OUName."
    }
}
